# Class Assignment 2 (part 1) Report

Topic of this assignment: Build Tools with Gradle

## 1. Analysis, Design and Implementation

### **Gradle, an open-source build automation tool**

[Gradle](https://gradle.org/) uses scripts written in Groovy or Kotlin DSL to automate your builds. It's open-source and highly customizable.

"Gradle is the official build tool for Android, and comes with support for many popular languages and technologies." This makes Gradle currently one of the most used building tools.

### **Assignment**

The goal of the Part 1 of this assignment is to practice Gradle using a very simple example. 
The following chapters describe in more detail each step taken to finalize the assignment.

### **Create folder for the assignment**

A new folder needs to be created for this assignment. Also a Readme file to describe this assignment needs to be added. The following command will do this:

```console
❯ pwd
../Switch/10_Projects/devops-20-21-1201779

❯ mkdir -p ca2/part1
❯ cd ca2/part1
❯ touch README.md
```

### **Clone the application example**

Import the example application that will be used to acquire some experience with Gradle.

```console
❯ pwd
../Switch/10_Projects/devops-20-21-1201779/ca2/part1

❯ git clone https://mendes-r@bitbucket.org/luisnogueira/gradle_basic_demo.git

❯ ls
README.md		gradle_basic_demo
```

The application is available on Bitbucket, and as exemplified above, we used the _git clone_ command to get it.
We also need to delete the _.git_ folder and _.gitignore_ file from this imported application so that it does not interfere with the class repository were this app is now inserted.

```console
❯ ls -a
.
..
.git
.gitignore
README.md
build.gradle
gradle
gradle.properties
gradlew
gradlew.bat
settings.gradle
src

❯ rm -rf .git
❯ rm .gitignore
```

We need also to update the _.gitignore_ from the class repositories to ignore the some Gradle artifacts.

This lines need to be added:

```bash
### Gradle ###
.gradle
build
gradle

# Ignore Gradle GUI config
gradle-app.setting

# Avoid ignoring Gradle wrapper jar file (.jar files are usually ignored)
!gradle-wrapper.jar

# Cache of project
.gradletasknamecache
 
### Gradle Patch ###
**/build/
```

src: [gitignore.io](gitignore.io)

### **Create a branch for the assignment**

To create a new branch for this assignment, run the following command:

```console
❯ git checkout -b ca2-part1
❯ git status
No ramo ca2-part1
não há nada para submeter, árvore de trabalho limpa

❯ git push --set-upstream origin ca2-part1
```

The last line pushes the new branch to our remote repository

### **Add new task to execute the server**

A new task needs to be added to execute the server. This is done in the _build.gradle_ file. To do this we add the following lines:

```console
task runServer(type: JavaExec, dependsOn: classes){
    group = "DevOps"
    description = "Launches the chat server on localhost:59001"

    classpath = sourceSets.main.runtimeClasspath

    main = "basic_demo.ChatServerApp"

    args '59001'
}
```

The _main_ specifies which class as the code to run the server app. 
If we take a look to the code of this class, we see that it receives an argument that specifies the server's port.
The _args_ line do this, and defines it with the number _59001_

If we run this script we can see that it works perfectly.

```console
❯ ./gradlew runServer
> Task :compileJava
> Task :processResources
> Task :classes

> Task :runServer
The chat server is running...
```

Update the example application's Readme file to include this task as an alternative to run the server.

### **Add test and JUnit dependency**

To do this we need to create a test folder.

```console
❯ pwd
../Switch/10_Projects/devops-20-21-1201779/ca2/part1/gradle_basic_demo/src

❯ mkdir -p test/java/basic-demo
❯ touch AppTest.java
```

Add this test to the created file:

```console
/*
 * This Java source file was generated by the Gradle ’init’ task.
 */
package basic_demo;
import org.junit.Test;
import static org.junit.Assert.*;

public class AppTest {
    @Test public void testAppHasAGreeting() {
        App classUnderTest = new App();
        assertNotNull("app should have a greeting", classUnderTest.getGreeting());
    }
}
```

To add JUnit to the project we need to supply the _testImplementation_ dependency to the _build.gradle_ file.

``` console
dependencies {
    // Use Apache Log4J for logging
    implementation group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.11.2'
    implementation group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.11.2'

    // JUnit test framework
    testImplementation 'junit:junit:4.12'
}
```

The _testImplementation_ configuration extends the _implementation_ configuration.

If we try to run the test through the command line interface we will have the following result:

```console
❯ gradle clean test
> Task :clean
> Task :compileJava
> Task :processResources
> Task :classes
> Task :compileTestJava
> Task :processTestResources NO-SOURCE
> Task :testClasses
> Task :test

BUILD SUCCESSFUL in 2s
5 actionable tasks: 5 executed
```

Success!

```console
❯ gradle clean test --scan
```

The _--scan_ flag give us the possibility to have access to a web-based report that will show us more details.

### **Add task to backup src folder**

Before adding this task, we need to create a folder were we will store the backup files.

```console
❯ pwd
...//Switch/10_Projects/devops-20-21-1201779/ca2/part1/gradle_basic_demo

❯ mkdir backup
```

The following task will able us to make a backup of the _src_ folder to the previous created _backup_ folder.

```console
task backupSrc(type: Copy){
    group = "DevOps"
    description = "Makes a backup of the src folder"

    from 'src/'
    into 'backup'
}
```

The _from_ defines the files and folders that we want to copy.
The _int_ specifies the destiny of the copied files / folders.

By running this new script, and if we have done everything correctly, we will see the following result:

```console
❯ pwd
...//Switch/10_Projects/devops-20-21-1201779/ca2/part1/gradle_basic_demo

❯ ./gradlew backupSrc
> Task :compileJava UP-TO-DATE
> Task :processResources UP-TO-DATE
> Task :classes UP-TO-DATE
> Task :backupScr UP-TO-DATE

BUILD SUCCESSFUL in 756ms
3 actionable tasks: 3 up-to-date
```

A quick look to the _backup_ folder will confirm that the files were copied correctly

If the folder does not exits, this task will created it. So the first step of this capter is unecessary.

### **Add task to zip src folder**

This new task wants to create an _.zip_ file from the content of our _src_ folder.

```console
task archiveSrc(type: Zip){
    group = "DevOps"
    description = "Makes an archive of the src folder"

    archiveFileName = "src.zip"
    destinationDirectory = file("backup")

    from "src"
}
```

The _archiveFileName_ specifies the name of the _.zip_ file.

The _destinationDirectory_ defines the location were we want to store the created _.zip_ file.

Finally the _from_ defines which folder or file we want to archive.

### **Merge branch to master**

After the assignment is done we can merge the _ca2-part1_ branch with the _master_ branch.

```console
❯ git checkout master
❯ git status
No ramo master
Your branch is up to date with 'origin/master'.

❯ git merge ca2-part1
```

### **Tag last assignment commit**

To tag the last commit of this assignment we run the following command:

```console
❯ git tag -a ca2-part1 -m "class assignment 2 - part 1"
❯ git push origin ca2-part1
```

THE END!
